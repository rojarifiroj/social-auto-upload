#!/usr/bin/env python3
"""
Project Reorganization Script
Organize project directory structure to make it clearer and more professional
"""

import os
import shutil
from pathlib import Path


def create_new_structure():
    """Create new directory structure"""
    print("üìÅ Creating new directory structure...")
    
    # Main directories
    main_dirs = [
        "src",                    # Source code directory
        "src/core",              # Core functionality
        "src/platforms",         # Platform implementations
        "src/utils",             # Utility modules
        "src/config",            # Configuration management
        "tools",                 # Tool scripts
        "tools/video_processing", # Video processing tools
        "tools/cookie_manager",   # Cookie management tools
        "docs",                  # Documentation
        "tests",                 # Tests
        "assets",                # Resource files
        "assets/media",          # Media files
        "assets/templates",      # Template files
        "data",                  # Data files
        "data/cookies",          # Cookie storage
        "data/logs",             # Log files
        "data/records",          # Record files
        "data/titles",           # Title files
        "data/videos",           # Video files
    ]
    
    for dir_path in main_dirs:
        Path(dir_path).mkdir(parents=True, exist_ok=True)
        print(f"‚úÖ Created directory: {dir_path}")


def move_core_files():
    """Move core files"""
    print("\nüì¶ Moving core files...")
    
    # Core file mappings
    core_files = {
        "cli_main.py": "src/core/",
        "conf.py": "src/config/",
        "utils/config_manager.py": "src/config/",
        "utils/base_social_media.py": "src/utils/",
        "utils/constant.py": "src/utils/",
        "utils/files_times.py": "src/utils/",
        "utils/log.py": "src/utils/",
        "utils/stealth.min.js": "src/utils/",
    }
    
    for src, dst in core_files.items():
        if Path(src).exists():
            try:
                shutil.move(src, dst)
                print(f"‚úÖ Moved: {src} -> {dst}")
            except Exception as e:
                print(f"‚ùå Failed to move {src}: {e}")


def move_platform_files():
    """Move platform-related files"""
    print("\nüåê Moving platform files...")
    
    # Platform file mappings
    platform_files = {
        "uploader/douyin_uploader/": "src/platforms/douyin/",
        "uploader/tencent_uploader/": "src/platforms/tencent/",
        "uploader/bilibili_uploader/": "src/platforms/bilibili/",
        "uploader/xhs_uploader/": "src/platforms/xhs/",
        "uploader/tk_uploader/": "src/platforms/tiktok/",
        "uploader/ks_uploader/": "src/platforms/kuaishou/",
    }
    
    for src, dst in platform_files.items():
        if Path(src).exists():
            try:
                if Path(dst).exists():
                    shutil.rmtree(dst)
                shutil.move(src, dst)
                print(f"‚úÖ Moved: {src} -> {dst}")
            except Exception as e:
                print(f"‚ùå Failed to move {src}: {e}")


def move_tool_files():
    """Move tool files"""
    print("\nüõ†Ô∏è  Moving tool files...")
    
    # Tool file mappings
    tool_files = {
        "get_douyin_cookie.py": "tools/cookie_manager/",
        "get_tencent_cookie.py": "tools/cookie_manager/",
        "get_bilibili_cookie.py": "tools/cookie_manager/",
        "get_tk_cookie.py": "tools/cookie_manager/",
        "upload_video_to_douyin.py": "tools/upload_tools/",
        "upload_video_to_bilibili.py": "tools/upload_tools/",
        "upload_video_to_tiktok.py": "tools/upload_tools/",
        "videomaker.py": "tools/video_processing/",
        "ziti.py": "tools/video_processing/",
        "watermark.py": "tools/video_processing/",
        "picdownload.py": "tools/video_processing/",
    }
    
    # Create tool subdirectories
    Path("tools/upload_tools").mkdir(exist_ok=True)
    
    for src, dst in tool_files.items():
        if Path(src).exists():
            try:
                shutil.move(src, dst)
                print(f"‚úÖ Moved: {src} -> {dst}")
            except Exception as e:
                print(f"‚ùå Failed to move {src}: {e}")


def move_video_processing():
    """Move video processing related files"""
    print("\nüé¨ Moving video processing files...")
    
    # Move cutvideo directory contents
    if Path("cutvideo").exists():
        try:
            # Move files
            cutvideo_files = [
                "cutvideo/cutvideo.py",
                "cutvideo/cutvideobak.py", 
                "cutvideo/videomakerp_dy.py"
            ]
            
            for file_path in cutvideo_files:
                if Path(file_path).exists():
                    shutil.move(file_path, "tools/video_processing/")
                    print(f"‚úÖ Moved: {file_path} -> tools/video_processing/")
            
            # Delete empty cutvideo directory
            if not any(Path("cutvideo").iterdir()):
                shutil.rmtree("cutvideo")
                print("‚úÖ Deleted empty directory: cutvideo")
                
        except Exception as e:
            print(f"‚ùå Failed to move video processing files: {e}")


def move_data_files():
    """Move data files"""
    print("\nüìä Moving data files...")
    
    # Data file mappings
    data_files = {
        "cookies/": "data/cookies/",
        "logs/": "data/logs/",
        "videos/": "data/videos/",
        "media/": "assets/media/",
    }
    
    for src, dst in data_files.items():
        if Path(src).exists():
            try:
                if Path(dst).exists():
                    # Merge directory contents
                    for item in Path(src).iterdir():
                        if item.is_file():
                            shutil.move(str(item), dst)
                        elif item.is_dir():
                            shutil.move(str(item), dst)
                    shutil.rmtree(src)
                else:
                    shutil.move(src, dst)
                print(f"‚úÖ Moved: {src} -> {dst}")
            except Exception as e:
                print(f"‚ùå Failed to move {src}: {e}")


def move_record_files():
    """Move record files"""
    print("\nüìù Moving record files...")
    
    record_files = [
        "bilibili_upload_record.txt",
        "upload_record.json", 
        "processed_files.txt",
        "video_processing.log",
        "bilibili_title_p.txt",
        "douyin_title_p.txt",
        "bilibili_title.txt",
    ]
    
    for file_path in record_files:
        if Path(file_path).exists():
            try:
                if file_path.endswith(('.txt', '.json')):
                    if 'title' in file_path:
                        shutil.move(file_path, "data/titles/")
                        print(f"‚úÖ Moved: {file_path} -> data/titles/")
                    elif 'record' in file_path or 'processed' in file_path:
                        shutil.move(file_path, "data/records/")
                        print(f"‚úÖ Moved: {file_path} -> data/records/")
                    elif 'log' in file_path:
                        shutil.move(file_path, "data/logs/")
                        print(f"‚úÖ Moved: {file_path} -> data/logs/")
            except Exception as e:
                print(f"‚ùå Failed to move {file_path}: {e}")


def move_documentation():
    """Move documentation files"""
    print("\nüìö Moving documentation files...")
    
    doc_files = [
        "README.MD",
        "QUICKSTART.md", 
        "CHANGELOG.md",
        "LICENSE",
    ]
    
    for file_path in doc_files:
        if Path(file_path).exists():
            try:
                shutil.move(file_path, "docs/")
                print(f"‚úÖ Moved: {file_path} -> docs/")
            except Exception as e:
                print(f"‚ùå Failed to move {file_path}: {e}")


def move_examples():
    """Move example files"""
    print("\nüí° Moving example files...")
    
    if Path("examples").exists():
        try:
            shutil.move("examples", "docs/examples")
            print("‚úÖ Moved: examples -> docs/examples")
        except Exception as e:
            print(f"‚ùå Failed to move examples: {e}")


def create_new_main_files():
    """Create new main files"""
    print("\nüìÑ Creating new main files...")
    
    # Create new __init__.py files
    init_files = [
        "src/__init__.py",
        "src/core/__init__.py",
        "src/platforms/__init__.py",
        "src/utils/__init__.py",
        "src/config/__init__.py",
        "tools/__init__.py",
        "tools/video_processing/__init__.py",
        "tools/cookie_manager/__init__.py",
        "tools/upload_tools/__init__.py",
    ]
    
    for init_file in init_files:
        Path(init_file).touch()
        print(f"‚úÖ Created: {init_file}")


def create_new_config():
    """Create new configuration files"""
    print("\n‚öôÔ∏è  Creating new configuration files...")
    
    # Move configuration files
    if Path("config/config.yaml").exists():
        try:
            shutil.move("config/config.yaml", "src/config/config.yaml")
            shutil.move("config/config.example.yaml", "src/config/config.example.yaml")
            print("‚úÖ Moved configuration files to src/config/")
        except Exception as e:
            print(f"‚ùå Failed to move configuration files: {e}")


def update_imports():
    """Update import paths"""
    print("\nüîß Updating import paths...")
    
    # Here you can add logic to automatically update import paths
    # Since it's complex, manual checking and updating is recommended
    print("‚ö†Ô∏è  Please manually check and update import paths in code")


def create_project_structure_doc():
    """Create project structure documentation"""
    print("\nüìã Creating project structure documentation...")
    
    structure_doc = """# Project Structure Documentation

## üìÅ Directory Structure

```
social-auto-upload/
‚îú‚îÄ‚îÄ src/                    # Source code directory
‚îÇ   ‚îú‚îÄ‚îÄ core/              # Core functionality
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cli_main.py    # Command line main program
‚îÇ   ‚îú‚îÄ‚îÄ platforms/         # Platform implementations
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ douyin/        # Douyin platform
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tencent/       # Tencent video platform
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bilibili/      # Bilibili platform
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ xhs/           # Xiaohongshu platform
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tiktok/        # TikTok platform
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ kuaishou/      # Kuaishou platform
‚îÇ   ‚îú‚îÄ‚îÄ utils/             # Utility modules
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_social_media.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ constant.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ files_times.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ log.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stealth.min.js
‚îÇ   ‚îî‚îÄ‚îÄ config/            # Configuration management
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ config_manager.py
‚îÇ       ‚îú‚îÄ‚îÄ config.yaml
‚îÇ       ‚îî‚îÄ‚îÄ config.example.yaml
‚îú‚îÄ‚îÄ tools/                 # Tool scripts
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ video_processing/  # Video processing tools
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cutvideo.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ videomaker.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ watermark.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ziti.py
‚îÇ   ‚îú‚îÄ‚îÄ cookie_manager/    # Cookie management tools
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ get_douyin_cookie.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ get_tencent_cookie.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ get_bilibili_cookie.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ get_tk_cookie.py
‚îÇ   ‚îî‚îÄ‚îÄ upload_tools/      # Upload tools
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ upload_video_to_douyin.py
‚îÇ       ‚îú‚îÄ‚îÄ upload_video_to_bilibili.py
‚îÇ       ‚îî‚îÄ‚îÄ upload_video_to_tiktok.py
‚îú‚îÄ‚îÄ docs/                  # Documentation
‚îÇ   ‚îú‚îÄ‚îÄ README.MD
‚îÇ   ‚îú‚îÄ‚îÄ QUICKSTART.md
‚îÇ   ‚îú‚îÄ‚îÄ CHANGELOG.md
‚îÇ   ‚îú‚îÄ‚îÄ LICENSE
‚îÇ   ‚îî‚îÄ‚îÄ examples/          # Usage examples
‚îú‚îÄ‚îÄ assets/                # Resource files
‚îÇ   ‚îú‚îÄ‚îÄ media/             # Media files
‚îÇ   ‚îî‚îÄ‚îÄ templates/         # Template files
‚îú‚îÄ‚îÄ data/                  # Data files
‚îÇ   ‚îú‚îÄ‚îÄ cookies/           # Cookie storage
‚îÇ   ‚îú‚îÄ‚îÄ logs/              # Log files
‚îÇ   ‚îú‚îÄ‚îÄ records/           # Record files
‚îÇ   ‚îú‚îÄ‚îÄ titles/            # Title files
‚îÇ   ‚îî‚îÄ‚îÄ videos/            # Video files
‚îú‚îÄ‚îÄ tests/                 # Tests
‚îú‚îÄ‚îÄ scripts/               # Project scripts
‚îÇ   ‚îú‚îÄ‚îÄ init_project.py
‚îÇ   ‚îú‚îÄ‚îÄ migrate_config.py
‚îÇ   ‚îú‚îÄ‚îÄ cleanup_project.py
‚îÇ   ‚îú‚îÄ‚îÄ quick_cleanup.py
‚îÇ   ‚îî‚îÄ‚îÄ reorganize_project.py
‚îú‚îÄ‚îÄ requirements.txt       # Dependencies file
‚îú‚îÄ‚îÄ setup.py              # Installation configuration
‚îî‚îÄ‚îÄ .gitignore            # Git ignore file
```

## üîß Main Module Descriptions

### src/core/
Core functionality module, containing command line interface and main business logic.

### src/platforms/
Implementations for various social media platforms, one subdirectory per platform.

### src/utils/
Common utility modules, containing base classes, constants, file processing, etc.

### src/config/
Configuration management module, unified project configuration management.

### tools/
Various tool scripts, categorized by functionality.

### docs/
Project documentation and usage examples.

### data/
Runtime data storage, containing cookies, logs, records, etc.

### assets/
Static resource files, such as media files and templates.

## üìù Usage Instructions

1. **Develop new features**: Add code in the `src/` directory
2. **Add new platforms**: Create new directories in `src/platforms/`
3. **Add tools**: Add to `tools/` directory categorized by functionality
4. **Manage configuration**: Use the configuration manager in `src/config/`
5. **Store data**: Place runtime data in the `data/` directory

## üîÑ Migration Notes

After project reorganization, the following content needs to be updated:
1. Import paths
2. Configuration file paths
3. Relative path references
4. Path descriptions in documentation
"""
    
    with open("docs/PROJECT_STRUCTURE.md", "w", encoding="utf-8") as f:
        f.write(structure_doc)
    
    print("‚úÖ Created project structure documentation: docs/PROJECT_STRUCTURE.md")


def main():
    """Main function"""
    print("üöÄ Starting project structure reorganization...\n")
    
    # Create new structure
    create_new_structure()
    
    # Move files
    move_core_files()
    move_platform_files()
    move_tool_files()
    move_video_processing()
    move_data_files()
    move_record_files()
    move_documentation()
    move_examples()
    
    # Create new files
    create_new_main_files()
    create_new_config()
    
    # Create documentation
    create_project_structure_doc()
    
    # Update imports
    update_imports()
    
    print("\nüéâ Project reorganization completed!")
    print("\nüìã Next steps:")
    print("1. Check and update import paths in code")
    print("2. Test if the project runs normally")
    print("3. Update path descriptions in documentation")
    print("4. Run tests to ensure functionality is normal")


if __name__ == "__main__":
    main() 